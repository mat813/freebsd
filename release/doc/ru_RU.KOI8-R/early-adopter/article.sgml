<!--
   The FreeBSD Russian Documentation Project

   $FreeBSD$
   $FreeBSDru: frdp/release/doc/ru_RU.KOI8-R/early-adopter/article.sgml,v 1.6 2004/08/12 08:31:34 den Exp $

   Original revision: 1.21.2.7
-->

<!DOCTYPE article PUBLIC "-//FreeBSD//DTD DocBook V4.1-Based Extension//EN" [
<!ENTITY % articles.ent PUBLIC "-//FreeBSD//ENTITIES DocBook FreeBSD Articles Entity Set//EN">
%articles.ent;

<!ENTITY % release PUBLIC "-//FreeBSD//ENTITIES Release Specification//EN">
%release;

<!ENTITY release.4x "4.<replaceable>X</replaceable>">
<!ENTITY release.5x "5.<replaceable>X</replaceable>">
<!ENTITY release.4last "4.11-RELEASE">
<!ENTITY release.5branchpoint "5.3-RELEASE">
]>

<article lang="ru">
  <articleinfo>
    <title>Руководство по миграции на &os; &release.current;</title>

    <authorgroup>
      <corpauthor>Группа подготовки релизов &os;</corpauthor>
    </authorgroup>

    <pubdate>$FreeBSD$</pubdate>

    <copyright>
      <year>2002</year>
      <year>2003</year>
      <year>2004</year>
      <year>2005</year>
      <holder role="mailto:re@FreeBSD.org">Группа подготовки релизов
	&os;</holder>
    </copyright>

    <legalnotice id="trademarks" role="trademarks">
      &tm-attrib.freebsd;
      &tm-attrib.apple;
      &tm-attrib.ibm;
      &tm-attrib.ieee;
      &tm-attrib.intel;
      &tm-attrib.microsoft;
      &tm-attrib.sparc;
      &tm-attrib.general;
    </legalnotice>

    <abstract>
      <para>Эта статья описывает основные отличия между &os; &release.4x;
	и &os; &release.current; с точки зрения пользователей
	или администраторов, обновляющих существующую систему.
	В ней дан краткий обзор процесса подготовки релизов &os;.
	Кроме того, описаны некоторые новые возможности &os; &release.5x;,
	а также некоторые изменения, которые могут быть интересны
	пользователям, привыкшим работать с серией релизов &release.4x;.
	Эта статья описывает также процедуры обновления существующих систем,
	как бинарного, так и из исходных текстов.  Более ранние версии
	этой статьи публиковались в предыдущих релизах &os; &release.5x;.
	До &os; &release.5branchpoint; эта статья называлась
	<quote>Руководство для новых пользователей FreeBSD</quote>.</para>
    </abstract>
  </articleinfo>

  <sect1 id="intro">
    <title>Введение</title>

    <para>&os; &release.current; это самая свежая версия
      <quote>&os.stable;</quote>.  Этот и последующие релизы
      серии &release.5x; предназначены для применения в реальных
      задачах практически так же, как и предыдущая серия
      релизов &release.4x;.</para>

    <para>Эта статья затрагивает многие темы и вопросы, связанные с обновлением
      &release.4x; до &release.current;.  Она начинается с краткого
      обзора существующей практики подготовки релизов, а затем описывает
      некоторые из новых возможностей, доступных в серии &os; &release.5x;.
      В возможно наиболее важном разделе приводятся основные изменения,
      видимые пользователю, или изменения во внешних интерфейсах программ.
      Наконец, приводятся заметки по обновлению установленной
      системы &os; &release.4x; до &os; &release.current;,
      бинарному или из исходных текстов.</para>

  </sect1>

  <sect1 id="release-overview">
    <title>Обзор процесса выпуска релизов &os;</title>

    <para>&os; использует модель разработки, основанную на наличии
      множества ветвей в репозитории исходных текстов.
      Основная ветвь называется <quote>CURRENT</quote>, и в репозитории
      CVS она означает тег <literal>HEAD</literal>.  Новые возможности
      сначала вносятся в эту ветвь; хотя CURRENT
      первой получает новую функциональность, это также означает, что она
      периодически страдает от нарушений работоспособности при добавлении
      и отладке новых возможностей.</para>

    <para>Большинство релизов &os; выпускаются из одной или нескольких
      ветвей <quote>STABLE</quote>.  В эти ветви возможности добавляются
      только после некоторого тестирования в CURRENT.  Последние два года
      только одна ветвь STABLE, известная как <quote>4-STABLE</quote>,
      находилась в активной разработке, и все релизы &os;
      &release.4x; были выпущены из нее.  В репозитории CVS тег этой ветви
      <literal>RELENG_4</literal>.</para>

    <para>Последние две стабильные ветви (3-STABLE and 4-STABLE) были
      созданы на самых ранних стадиях цикла разработки
      (при выпуске 3.1 и 4.0 соответственно).
      Эта практика не дает достаточно времени для стабилизации
      CURRENT перед созданием новых ветвей.  Это приводит к потере времени
      на усилия по портированию исправлений между ветвями, а также
      на внесение некоторые архитектурных изменений, которые вообще не могут
      быть портированы между ветвями.</para>

    <para>Поэтому группа подготовки релизов создаст ветвь 5-STABLE в
      репозитории CVS только после достижения относительно стабильного
      состояния.  Перед этим будет выпущено несколько релизов из серии
      &release.5x;; мы ожидаем создания 5-STABLE приблизительно во
      время выпуска &release.5branchpoint;.</para>

    <para>С релизами &release.5x; произошло несколько иначе.
      &os; 5.0, 5.1, и 5.2 были основаны на ветви CURRENT.  Первый из
      этих релизов был выпущен после двух лет разработки
      (до него последним релизом из HEAD была &os; 4.0 в марте
      2000 года).</para>

    <para>В отличие от предыдущих ветвей <quote>STABLE</quote>, ветвь
      <quote>5-STABLE</quote> (с тегом ветви
      <literal>RELENG_5</literal>) была создана в CVS более чем через
      год после первого релиза &release.5x; (а именно, в процессе
      подготовки релиза 5.3).  Эта задержка дала команде разработчиков время
      для завершения необходимых архитектурных изменений, стабилизацию
      системы, завершения работы над различными интерфейсами, и создания
      хорошей основы для последующих релизов &release.5x;.</para>

    <para>Помимо общих улучшений и исправлений ошибок, основной приоритет
      для разработки ветви 5-STABLE это сохранение совместимости
      Application Binary Interface (ABI) и
      Application Program Interface (API).
      Любые изменения, которые могут нарушить обратную совместимость
      (включая интерфейсы ядра или библиотек), не приветствуются и не
      принимаются, за исключением случаев, когда они необходимы для
      решения критической проблемы.</para>

    <para>Следующим релизом из CURRENT скорее всего станет 6.0-RELEASE,
      созданный из CVS <literal>HEAD</literal>.  Еще не существует
      определенной даты для 6.0, но на момент написания этого текста
      ожидаемая дата находится в третьем квартале 2005 года.  В дальнейшем
      планируется начинать выпуск релизов из основной ветви каждые
      восемнадцать месяцев, при этом выпуская обычные релизы каждые
      четыре месяца.</para>

    <para>Последним запланированным релизом из ветви разработки 4-STABLE
      стал &release.4last;, анонс которого состоялся в январе 2005 года.
      На данный момент больше не планируется выпуск релизов из ветви
      4-STABLE, и вся дальнейшая работа будет ограничена исправлением
      ошибок и проблем с безопасностью.  Для особо консервативных
      пользователей возможно имеет смысл продолжить использование
      релизов &release.4x; еще некоторое время.  &a.security-officer;
      продолжит поддержку релизов, выпущенных из ветви 4-STABLE в
      соответствии с опубликованными политиками, которые можно
      найти на <ulink
      url="&url.base;/ru/security/index.html">странице безопасности</ulink>
      веб сайта &os;.</para>

    <para>Дополнительную информацию по процессу создания релизов &os;
      можно найти на <ulink
      url="&url.base;/releng/index.html">веб страницы
      выпуска релизов</ulink> и в статье <ulink
      url="&url.articles.releng;/index.html"><quote>Выпуск
      релизов &os;</quote></ulink>.</para>

  </sect1>

  <sect1 id="new">
    <title>Новые возможности</title>

    <para>&os; &release.5x; привлекает большим количеством новых
      возможностей, которые обычно вызывают
      серьезные архитектурные изменения, которые не могут быть портированы
      обратно в ветвь разработки &os; 4-STABLE (напротив, множество
      автономных расширений, таких как новые драйвера устройств или
      обновления утилит пользователя, уже были портированы).  Краткий, но не
      исчерпывающий список включает:</para>

    <itemizedlist>
      <listitem>
	<para>SMPng: <quote>Новое поколение</quote> поддержки Symmetric MultiProcessor
	  (SMP) компьютеров.  Продолжается работа над
	  <quote>fine-grained locking</quote> различных подсистем
	  ядра для увеличения количества потоков выполнения, которые
	  могут работать в ядре.  Особое внимание было уделено
	  производительности сетевого стека и устройств хранения.  Дополнительную информацию можно
	  найти на странице <ulink url="&url.base;/smp/index.html">FreeBSD
	  SMP проекта</ulink>.</para>
      </listitem>

      <listitem>
	<para>KSE:  Kernel Scheduled Entities позволяют одному процессу
	  иметь несколько потоков уровня ядра, подобно Scheduler
	  Activations.  Библиотеки потоков <filename>libpthread</filename>
	  и <filename>libthr</filename> делают эти возможности доступными
	  многопоточным программам пользователя через API
	  &man.pthread.3;.  <filename>libpthread</filename> теперь является
	  библиотекой потоков по умолчанию.</para>
      </listitem>

      <listitem>
	<para>Новые архитектуры:  Поддержка архитектур amd64,
	  ia64, pc98 и sparc64 в дополнение к i386 и alpha.
	  Другие платформы, включая powerpc (которая работает на многих
	  &powerpc; &macintosh;) и arm, находятся в разработке.</para>
      </listitem>

      <listitem>
	<para>GCC:  Набор инструментов компилятора теперь основан на
	  3.4.<replaceable>X</replaceable>, вместо GCC
	  2.95.<replaceable>X</replaceable>.</para>
      </listitem>

      <listitem>
	<para>MAC:  Поддержка расширяемых, загружаемых политик
	  Mandatory Access Control (принудительный контроль доступа).</para>
      </listitem>

      <listitem>
	<para>GEOM:  Гибкая, модульная подсистема трансформации запросов
	  ввода/вывода на диск.  Эта система поддерживает множество
	  возможностей, относящихся к дискам и томам, таких как:
	  Определение дисковых разделов, шифрование посредством
	  &man.gbde.4;, различные уровни RAID, сетевой экспорт дисковых
	  устройств (с &man.ggated.8; относящимися к нему утилитами),
	  а также прозрачное разжатие дисков.  Система geom_vinum
	  добавила совместимость с GEOM к менеджеру томов VINUM.</para>
      </listitem>

      <listitem>
	<para>FFS: Файловая система FFS теперь поддерживает фоновые операции
	  &man.fsck.8; (для более быстрого восстановления после сбоев) и
	  снэпшоты файловой системы.</para>
      </listitem>

      <listitem>
	<para>UFS2:  Был добавлен новый дисковый формат UFS2, поддерживающий
	  расширенные файловые атрибуты и большие размеры файлов.
	  UFS2 теперь формат по умолчанию для &man.newfs.8;.  На всех
	  платформах, за исключением pc98, файловые системы, созданные
	  из &man.sysinstall.8;, используют UFS2 по умолчанию.</para>
      </listitem>

      <listitem>
	<para>Новые сетевые возможности:  Множество новых сетевых
	  возможностей впервые появились в релизах &release.5x;,
	  включая поддержку TCP SACK (selective acknowledgements),
	  пакетный фильтр &man.pf.4; из OpenBSD, и систему
	  управления пакетами ALTQ.</para>
      </listitem>

      <listitem>
        <para>Поддержка нового оборудования: Поддержка новых
	  аппаратных устройств, таких как Cardbus, Bluetooth
	  и сетевых интерфейсов IEEE 802.11a/b/g, основанных
	  на чипсетах Atheros.  Кроме того, для архитектуры
	  i386, некоторые сетевые устройства, не поддерживаемые
	  явно драйверами &os;, могут поддерживаться с использованием
	  драйверов для &microsoft; &windows; и уровня совместимости
	  &man.ndis.4; от поставщика оборудования.</para>
      </listitem>
    </itemizedlist>

    <para>Более полный список новых возможностей можно найти в информации
      о различных релизах &os; &release.5x;.</para>

  </sect1>

  <sect1 id="drawbacks">
    <title>Наиболее заметные изменения</title>

    <para>Некоторые из различий между &os; &release.4x; и
      &release.5x; заслуживают особого упоминания, поскольку они
      включают серьезные архитектурные изменения, или нарушение
      обратной совместимости.  Хотя эти изменения скорее всего
      не приведут к потере данных, они могут стать проблемой для
      тех, кто к ним не готов.  Некоторые примеры:</para>

    <itemizedlist>

<!-- General stuff -->

      <listitem>
        <para>Некоторые части функциональности базовой системы &os;
	  были перенесены в коллекцию портов &os;, обычно вследствие
	  того, что их проще поддерживать в этой форме, или поскольку
	  они на самом деле не являются необходимой частью базовой
	  системы.  Наиболее заметный пример такого переноса это
	  <application>Perl</application> (доступный из коллекции
	  портов &os; через порт <filename
	  role="package">lang/perl5.8</filename>), наличие которого
	  в базовой системе делало обновление проблематичным.
	  Утилиты базовой системы, написанные на
	  <application>Perl</application>, были или переписаны
	  или удалены (если они более не нужны).</para>

	<para>Другие примеры включают <application>UUCP</application>
          (доступный из коллекции портов как <filename
          role="package">net/freebsd-uucp</filename>),
	  утилиту <command>doscmd</command> (<filename
          role="package">emulators/doscmd</filename>), и многие из
	  традиционных игр (<filename
          role="package">games/freebsd-games</filename>).</para>
          </listitem>

<!-- Kernel ABI changes -->

      <listitem>
        <para>Изменения в структурах данных ядра и ABI/API
	  означает необходимость модификации множества бинарных
	  драйверов устройств сторонних поставщиков для
	  корректной работы в &os; &release.5x;.
	  В некоторых (редких) случаях изменены видимые пользователю
	  структуры данных, что требует перекомпиляции приложений
	  или переустановки портов/пакетов.  Как и с серией релизов
	  &release.4x;, целью команды разработки &os; является
	  недопущение внесения несовместимых изменений в будущие
	  релизы ветви &release.5x;.</para>
      </listitem>

      <listitem>
	<para>Недостаток интереса со стороны пользователей и отсутствие
	  поддержки некоторых частей базовой системы &os; привело к
	  утере их работоспособности.  Эти части были удалены.
	  Например, так случилось с исполняемыми файлами
	  <filename>a.out</filename>,
	    <footnote>
	      <para>Обратите внимание, что выполнение файлов
		<filename>a.out</filename> все еще поддерживается
		на i386 и pc98 с параметром ядра
		<literal>COMPAT_AOUT</literal>.  Некоторые из компиляторов
		коллекции портов (например, <filename
		role="package">lang/gcc28</filename>) все еще поддерживают
		создание исполняемых файлов стандарта
		<filename>a.out</filename>.</para>
	    </footnote>
	  поддержкой сетей XNS и драйвером X-10.  Многие другие драйверы
	  для старых ISA устройств стали неработоспособны и были удалены.
	  Дополнительные подробности находятся в информации о релизе.</para>
      </listitem>

      <listitem>
	<para>В &os;/i386 &release.4x; настройка ISA устройств вносилась
	  в конфигурацию ядра.  Ее можно было изменить во время загрузки
	  через интерактивную утилиту <application>UserConfig</application>.
	  В &os; &release.5x; оба этих механизма были заменены механизмом
	  &man.device.hints.5;, который делает ненужным жесткое задание
	  параметров настройки ISA в ядре.  Настройка ISA устройств во время
	  загрузки более не управляется через меню, вместо этого
	  вводятся параметры в приглашение командной строки загрузчика.</para>
      </listitem>

      <listitem>
	<para><filename>MAKEDEV</filename> более не существует и не
	  требуется.  &os; &release.5x; использует файловую систему
	  устройств, которая автоматически создает файлы устройств
	  по мере необходимости.  Настройка файловой системы устройств
	  может быть выполнена посредством утилиты &man.devfs.8; или через
	  механизм <filename>/etc/devfs.conf</filename>.  Дополнительная
	  информация находится на странице справочной системы
	  &man.devfs.5;.</para>
      </listitem>

      <listitem>
	<para>UFS2 стал дисковым форматом по умолчанию для файловых
	  систем, созданных с использованием &man.newfs.8;.  Для
	  всех платформ за исключением pc98 это также формат
	  по умолчанию файловых систем, созданных с использованием
	  экрана разметки в &man.sysinstall.8;.  Поскольку
	  &os; &release.4x; распознает только UFS1 (и не распознает
	  UFS2), дисковые разделы, к которым необходимо получать доступ
	  и из &release.5x; и из &release.4x;, должны быть созданы
	  с UFS1.  Этот формат может быть выбран параметром
	  <option>-O1</option> для &man.newfs.8;, или через экран
	  разметки диска в &man.sysinstall.8;.  Эта ситуация обычно
	  возникает на компьютере, где одновременно присутствуют
	  &os; &release.4x; &os; &release.5x;.  Обратите внимание,
	  что не существует способа преобразования файловых
	  системы между этими двумя форматами (кроме резервного
	  копирования, пересоздания файловой системы и восстановления
	  с резервной копии).</para>
      </listitem>

<!-- Userland -->

      <listitem>
	<para>Вследствие обновления компилятора
	  <application>GCC</application>, программы на C++ как правило
	  требуют перекомпиляции и переустановки.  Это требование
	  возникло вследствие изменений в C++ ABI.</para>
      </listitem>

      <listitem>
        <para>Запуск приложений, скомпилированных для &os; &release.4x;,
	  может быть возможен посредством дистрибутива
	  <filename>compat4x</filename> (или эквивалентного
	  порта/пакета <filename role="package">misc/compat4x</filename>).
	  Однако, если какой-либо порт или пакет в системе требует
	  обновления, рекомендуется пересборка и переустановка
	  <emphasis>всех</emphasis> установленных в системе портов.
	  Это предотвратит проблемы, которые могут появиться с программами,
	  использующими некоторую комбинацию старых и новых библиотек.
	  Утилита <filename role="package">sysutils/portupgrade</filename>
	  может помочь при переустановке портов.</para>

        <para>Обратите внимание, что в любом случае существует несколько
	  примеров обратной несовместимости.  Например, порты <filename
          role="package">devel/gnomevfs2</filename>, <filename
          role="package">mail/postfix</filename>, и <filename
          role="package">security/cfs</filename> необходимо
	  перекомпилировать вследствие изменений в структуре
	  <literal>statfs</literal>.</para>
      </listitem>

      <listitem>
        <para>Файл настройки разрешения имен <filename>host.conf</filename>
	  был замещен на (гораздо более общий) механизм настройки
	  сервисов имен &man.nsswitch.conf.5;.</para>
      </listitem>
 
      <listitem>
	<para><application>BIND</application> был обновлен с версии
	  8 до версии 9.  Между BIND 8 и 9 существует множество
	  различий.  Пользователям, для которых наличие &man.named.8;
	  необходимо, рекомендуется прочесть документацию по мигрированию в
	  <filename>/usr/share/doc/bind9/misc/migration</filename>.
	  Доступно также новое руководство в
	  <filename>/usr/share/doc/bind9/arm</filename>.  На системах,
	  где работает &man.named.8;, теперь он по умолчанию запускается
	  в среде &man.chroot.8; в <filename>/var/named</filename>.
	  Пользователям, у которых конфигурация &man.named.8; уже
	  расположена <filename>/var/named</filename>, рекомендуется
	  сделать резервную копию этого каталога перед обновлением,
	  чтобы избежать ее перезаписи стартовым скриптом
	  &man.named.8;.</para>
      </listitem>

<!-- Ports -->

      <listitem>
	<para>Реализация X Window System от <application>&xorg;</application>
	  устанавливается для &os; &release.5x; по умолчанию начиная с
	  5.3-RELEASE.  На момент написания данного текста,
	  <application>&xfree86;</application> остается по умолчанию в
	  &os; &release.4x;.  Дополнительную информацию по различию
	  между версиями, а также информацию по обновлению существующих
	  систем можно найти в главе <ulink
	  url="&url.books.handbook;/x11.html">X Window System</ulink>
	  Руководства &os;.</para>
      </listitem>

<!-- Documentation -->

      <listitem>
	<para>Документация (такая как <ulink
	  url="&url.books.handbook;/index.html">Руководство</ulink>
	  &os; и <ulink
	  url="&url.books.faq;/index.html">FAQ</ulink>)
	  все еще находится в процессе обновления, чтобы соответствовать
	  изменениям, недавно внесенным в &os; &release.5x;.</para>
      </listitem>

    </itemizedlist>

    <para>Дополнительная информация находится в документации на релиз
      к различным релизам &os; &release.5x;, а также в файле
      <filename>src/UPDATING</filename> из дерева исходных текстов
      &os;.  Значительные изменения в коллекции портов &os;
      приводятся в файлах <filename>ports/UPDATING</filename> и
      <filename>ports/CHANGES</filename> из дерева портов.</para>
  </sect1>

  <sect1 id="upgrade">
    <title>Заметки по обновлению с &os; &release.4x;</title>

    <para>Для пользователей системы &os; этот раздел предоставляет
      несколько заметок по обновлению &os; &release.4x; до
      &release.5x;.  Как и при любом обновлении &os;, необходимо
      прочесть информацию о релизе и список исправлений к новому
      релизу, а также <filename>src/UPDATING</filename> при
      обновлении из исходных текстов.</para>

    <sect2>
      <title>Бинарные обновления</title>

      <para>Возможно наиболее прямой способ это <quote>сохранить все,
	переформатировать, переустановить, и восстановить данные
	пользователя</quote>.
	Это исключает проблемы с несовместимыми или отсутствующими
	в новой версии исполняемыми файлами и файлами настройки,
	захламляющими новую систему.  Это позволяет создать новые
	файловые системы с новой функциональностью (наиболее значимая
	&mdash; UFS2 по умолчанию).</para>

      <para>На момент написания этого текста, опция бинарного обновления
	в меню &man.sysinstall.8; не была достаточно протестирована для
	обновлений между основными ветвями.  Использование этой
	возможности не рекомендуется.</para>

      <para>Некоторые изменения могут быть интересны пользователям,
	которые знакомы с загрузочными дискетами &os; &release.4x;.
	Загрузочные дискеты (на платформах, которые их поддерживают,
	например на i386), организованы несколько по-другому, чем
	в предыдущих релизах.  В релизах &release.4x; набор дискет
	включал урезанное ядро, достаточное лишь для того, чтобы
	установить систему.  Это позволяло ядру уместиться на одну
	дискету, но не позволяло поместить в него драйверы, необходимые
	для определенных аппаратных конфигураций.  Начиная с
	5.3-RELEASE, на установочных дискетах находится стандартное
	ядро <literal>GENERIC</literal>, распределенное на несколько
	дискет, с гораздо большим набором драйверов и возможностей.
	Загрузчик просит вставить дополнительные диски по мере
	необходимости.  Пользователям, загружающим образы дискет
	(возможно для установки по сети), необходимо обратить внимание
	на то, что набор теперь включает три дискеты:
	<filename>boot.flp</filename>,
        <filename>kern1.flp</filename>, и
        <filename>kern2.flp</filename>.</para>

      <para>Установочные CDROM для архитектуры &i386; теперь используют
	<quote>не-эмулирующий</quote> загрузчик.  Это позволяет,
	помимо прочего, использовать <literal>GENERIC</literal>
	ядро вместо урезанного ядра на дискетах предыдущих версий.  Как правило, любая система,
	способная загрузиться с установочных компакт дисков
	&microsoft; &windowsnt;&nbsp;4, &windows2k;, или &windowsxp;
	должна быть способна загрузиться
	с компакт дисков &release.5x;.</para>

      <para>Расположение файлов дистрибутива на CDROM было изменено по
	сравнению с серией релизов &release.4x;. Начиная с 5.4-RELEASE,
	установочный образ и <quote>live filesystem</quote> теперь
	находятся на первом диске для всех архитектур, за исключением
	ia64 (в релизах ia64 используются отдельные диски для установки
	и для live filesystem, поскольку они не помещаются на один диск).
	Широко используемые пакеты размещаются на втором и последующих
	дисках релиза.</para>

    </sect2>

    <sect2>
      <title>Обновление из исходных текстов</title>

      <note>
        <para>Многие и пользователи обнаружили, что проще всего
	  сделать резервное копирование данных и файлов настройки
	  (благоразумное предостережение для любого случая),
	  выполнить обычную установку и восстановить данные.
	  В отличие от обновления из исходных текстов, в этом случае
	  не требуется заботиться об оставшихся на диске файлах
	  и программах, и позволяет воспользоваться преимуществами
	  новой файловой системы UFS2.</para>

	<para>Пользователи, не знакомые с процедурами
	  <literal>buildworld</literal>/<literal>installworld</literal>
	  обновления &os; из исходных текстов, <emphasis>не</emphasis>
	  должны пытаться выполнить такое обновление, вместо этого
	  рекомендуется выполнить обычную установку после резервного
	  копирования всех данных.</para>
      </note>

      <para>При обновлении из исходных текстов на локальной машине
	собираются и устанавливаются бинарные файлы.  Это обновление
	основано на процедуре
	<literal>buildworld</literal>/<literal>installworld</literal>,
	часто используемой опытными пользователями &os; для
	отслеживания изменений в ветви разработки (такой как
	&os.stable; или &os.current;).  Как правило, это более сложная
	процедура, чем бинарное обновление, но она может быть полезна
	если файлы настройки системы сложны или серьезно модифицированы
	под имеющуюся установку.  Обновление из исходных текстов также
	может быть полезно, когда у администратора есть удаленный
	доступ к консоли, но нет физического доступа (и следовательно
	нет возможности вставить установочный диск).</para>

      <para>Прочтение <filename>src/UPDATING</filename> абсолютно
	необходимо.  Раздел, озаглавленный <quote>To upgrade in-place from
	4.x-stable to current</quote> содержит пошаговую процедуру
	обновления, которая должна быть в точности выполнена,
	без <quote>сокращений</quote>, которые зачастую применяют
	некоторые пользователи.  Сокращенный список этих шагов приведен
	ниже:</para>

      <orderedlist>
        <listitem>
	  <para>Сделайте резервные копии.</para>

	  <para>Важность этого шага невозможно переоценить.  Необходимо
	    сделать резервные копии всех данных пользователя и файлов
	    настройки.  Прекрасно подходит для этого &man.dump.8;
	    нулевого уровня, хотя конечно существует множество
	    работоспособных альтернатив.</para>
        </listitem>

	<listitem>
	  <para>Убедитесь, что в файловой системе <filename>/</filename>
	    присутствует около 30MB свободного места.</para>

	  <para>&os; &release.5x; требуется больше места, чем &os;
	    &release.4x;.  Если каталог <filename>/tmp</filename>
	    расположен в файловой системе <filename>/</filename> (а
	    зачастую это так), удаление всего содержимого этого каталога
	    может помочь высвободить место.</para>
	</listitem>

        <listitem>
	  <para>Подправьте <filename>/etc/fstab</filename> если
	    необходимо.</para>

	  <para>Этот пункт возможно относится только к старым системам
	    &os;/i386.  В системах, где используются дисковые слайсы
	    в MBR стиле, &os; поддерживает <quote>слайсы
	    совместимости</quote>, где имена дисковых разделов могут
	    принимать форму <filename>/dev/ad0a</filename> (без явного
	    указания имени слайса).  Это более не поддерживается,
	    дисковые разделы должны быть именованы в форме
	    <filename>/dev/ad0s1a</filename>.  Другими словами,
	    дисковые разделы теперь должны указываться полностью:
	    дисковое устройство, номер слайса и буква раздела.</para>

	  <para>Обратите внимание, что <quote>слайсы совместимости</quote>
	    обычно не используются по умолчанию начиная с &os;
	    2.2.6-RELEASE.  Этот пункт не относится к &os;/alpha вообще,
	    как и к системам, использующим режим <quote>dangerously
	    dediated</quote>.</para>
        </listitem>

	<listitem>
	  <para>Используя &man.cvs.1; или другие способы, получите
	    копию исходных текстов базовой системы &os; (модуль
	    <filename>src/</filename>).  Для извлечения 5.4-RELEASE
	    из CVS репозитория &os;, используйте тег
	    <literal>RELENG_5_4_0_RELEASE</literal>.  Для ветви 5.4
	    с исправлениями, используйте тег
	    <literal>RELENG_5_4</literal>.  Для отслеживания
	    ветви разработки &os; 5-STABLE, используйте тег ветви
	    <literal>RELENG_5</literal>.  При использовании CVS
	    для извлечения исходных текстов, важно установить для
	    CVS флаг <option>-P</option>, чтобы пустые каталоги
	    удалялись.</para>
	</listitem>

        <listitem>
	  <para>&os; &release.5x; требуются некоторые новые записи в
	    системных файлах паролей и групп, соответствующие различным
	    системным сервисам.  Они должны быть добавлены
	    командой:</para>

	  <screen>&prompt.root; <userinput>mergemaster -p</userinput></screen>

	  <para>Этот шаг необходимо выполнить, чтобы установить
	    пользователя и группу на некоторые новые файлы.</para>

	  <para>Обратите внимание, что в &os; &release.5x; файл утилиты
	    &man.nologin.8; переместился из
	    <filename>/sbin/nologin</filename> в
	    <filename>/usr/sbin/nologin</filename>.  Поскольку у многих
	    псевдо-пользователей &man.nologin.8; указана в качестве
	    оболочки, это изменение создаст дополнительные различия
	    в <filename>/etc/passwd</filename>.</para>
        </listitem>

        <listitem>
	  <para>Соберите новую систему с помощью:</para>

	  <screen>&prompt.root; <userinput>cd /usr/src</userinput>
&prompt.root; <userinput>make buildworld</userinput></screen>

	  <para>Если переменная <varname>CPUTYPE</varname> определена в
	    <filename>/etc/make.conf</filename>, она должна быть задана
	    оператором <literal>?=</literal>, чтобы процесс
	    <literal>buildworld</literal> мог переписать ее при
	    необходимости.</para>

	  <para>Обратите внимание, что <varname>MAKEOBJDIRPREFIX</varname>
	    <emphasis>нельзя</emphasis> определять в
	    <filename>/etc/make.conf</filename>.</para>

	  <para>Как правило, большая часть <quote>установок</quote>,
	    определенных в <filename>/etc/make.conf</filename>,
	    должна быть закомментирована или удалена.  Это
	    особенно важно для тех переменных, которые непосредственно
	    влияют на сборку или основные операции &os;, такие как
	    <varname>NO_TOOLCHAIN</varname>.</para>

        </listitem>

        <listitem>
	  <para>Соберите и установите новое ядро командой:</para>

	  <screen>&prompt.root; <userinput>make buildkernel</userinput></screen>

	  <para>Обратите внимание, что необходимо использовать
	    &man.make.1; <literal>buildkernel</literal>, чтобы убедиться,
	    что ядро будет собрано компилятором, собранным в предыдущем
	    действии.  Использование &man.config.8; вручную и последующая
	    сборка ядра не будут работать.</para>

	  <para>Хотя сборка (и последующая установка) собственного ядра в
	    данный момент возможна, обновление с использованием ядра
	    <literal>GENERIC</literal> и установка собственного ядра
	    позже предпочтительнее, поскольку вероятность ошибок ниже.
	    При сборке собственного ядра в первый раз настоятельно
	    рекомендуется в качестве основы использовать ядро
	    <literal>GENERIC</literal> из &os; &release.5x;, поскольку
	    многие устройства и параметры были добавлены или изменены
	    по сравнению с &release.4x;.  В любом случае, включение
	    параметра конфигурации <literal>COMPAT_FREEBSD4</literal>
	    необходимо для успешного обновления.</para>
        </listitem>

        <listitem>
	  <para>Настройте хинты устройств для устройств ISA с помощью
	    одного из варианта нижеприведенной команды.  Подставьте
	    соответствующее имя архитектуры (например
	    <literal>i386</literal>) вместо
	    <replaceable>MACHINE</replaceable>.</para>

	  <screen>&prompt.root; <userinput>cp sys/<replaceable>MACHINE</replaceable>/conf/GENERIC.hints /boot/device.hints</userinput></screen>

	  <para>Хотя пустой файл хинтов может быть достаточен для
	    современного оборудования, хинты ISA необходимы для
	    систем с ISA не-PNP картами (где хинты должны быть настроены),
	    для не-PNPBIOS систем, или для флоппи дисков, чтобы корректно
	    работать на PNPBIOS системах.</para>

        </listitem>

	<listitem>
	  <para>Установите новое ядро командой:</para>

	  <screen>&prompt.root; <userinput>make installkernel</userinput></screen>

	  <para>Обратите внимание, что в &os; &release.4x; ядро по умолчанию
	    устанавливается в <filename>/kernel</filename>, а в &os;
	    &release.5x; ядро устанавливается в
	    <filename>/boot/kernel/kernel</filename>.  Модули ядра в
	    &release.4x; обычно устанавливаются в каталог
	    <filename>/modules</filename>, а в
	    &release.5x; они устанавливаются в
	    <filename>/boot/kernel</filename>.</para>

	</listitem>

        <listitem>
	  <para>Установите загрузчик &os; &release.5x; командой:</para>

	  <screen>&prompt.root; <userinput>cd /usr/src/sys/boot</userinput>
&prompt.root; <userinput>make STRIP="" install</userinput></screen>

	  <para>Хотя этот шаг опционален, он настоятельно рекомендуется.</para>
	</listitem>

	<listitem>
	  <para>Отключите модули сторонних разработчиков
	    (такие как VMware) для предотвращения падений,
	    вызванных изменениями в ABI ядра или другими
	    несовместимостями.</para>
        </listitem>

        <listitem>
	  <para>Перезагрузитесь в однопользовательский режим.  Перезагрузка
	    абсолютно необходима, поскольку для установки новой системы
	    должно быть запущено новое ядро.  Однопользовательский
	    режим практически устранит различные случайности, которые
	    могут возникнуть во время обновления, так как другие
	    программы не будут запущены.</para>
	</listitem>

	<listitem>
	  <para>Смонтируйте необходимые файловые системы:</para>

	  <screen>&prompt.root; <userinput>fsck -p</userinput>
&prompt.root; <userinput>mount -uw /</userinput>
&prompt.root; <userinput>mount -at ufs</userinput></screen>

	  <para>Обратите внимание, что вызов &man.fsck.8; необходим для
	    обновления определенный полей в суперблоке файловой системы
	    для &os; &release.5x;.  Если системные часы работают в
	    локальном времени, а не в UTC, выполните также:</para>

	  <screen>&prompt.root; <userinput>adjkerntz -i</userinput></screen>

	  <para>Во время этого шага на консоли может появиться
	    следующее сообщение (множество раз).</para>

<screen>WARNING: userland calling deprecated sysctl, please rebuild world</screen>

	  <para>Оно может быть спокойно проигнорировано.</para>

        </listitem>

        <listitem>
	  <para>Удалите заголовки файлов C++:</para>

	  <screen>&prompt.root; <userinput>rm -rf /usr/include/g++</userinput></screen>

	  <para>Этот шаг предотвратит использование старых файлов
	    заголовков, оставшихся от компилятора
	    <application>GCC</application> 2.95 C++,
	    при дальнейших компиляциях.</para>
        </listitem>

        <listitem>
	  <para>Установите новую систему:</para>

	  <screen>&prompt.root; <userinput>cd /usr/src</userinput>
&prompt.root; <userinput>make installworld</userinput></screen>
        </listitem>

	<listitem>
	  <para>На системах, где установлен &man.named.8;, его
	    файлы настройки должны быть перемещены в
	    &man.chroot.8;, в каталог <filename>/var/named</filename>.
	    Если какие-либо файлы уже находятся в
	    <filename>/var/named</filename>, необходимо предварительно
	    сделать их резервную копию.</para>

	  <screen>&prompt.root; <userinput>cd /etc</userinput>
&prompt.root; <userinput>mv named named.bak</userinput>
&prompt.root; <userinput>mkdir -p /var/named/etc/namedb</userinput>
&prompt.root; <userinput>cp -Rp named.bak/* /var/named/etc/namedb</userinput></screen>

	  <para>Если в конфигурации использованы автоматически
	    созданные файлы <filename>localhost</filename>, для их
	    автоматической пересборки потребуется следующее:</para>

	  <screen>&prompt.root; <userinput>cd /var/named/etc/namedb</userinput>
&prompt.root; <userinput>/bin/sh make-localhost</userinput>
&prompt.root; <userinput>rm -f localhost-v6.rev localhost.rev</userinput></screen>

	  <para>Наконец, нужно удалить два устаревших бинарных файла от
	    предыдущих версий <application>BIND</application>:</para>

	  <screen>&prompt.root; <userinput>rm /usr/sbin/nslookup</userinput>
&prompt.root; <userinput>rm /usr/sbin/nsupdate</userinput></screen>

        </listitem>

        <listitem>
	  <para>Обновите конфигурацию системы, запустив:</para>

	  <screen>&prompt.root; <userinput>mergemaster -i</userinput></screen>

	  <para>Этот шаг не опционален.  Он необходим для приведения
	    стартовых файлов и файлов настройки из <filename>/etc</filename>
	    в соответствие новому ядру и системе.</para>

	  <para>После вызова &man.mergemaster.8;, неплохо будет проверить
	    (и возможно изменить) <filename>/etc/rc.conf</filename>.
	    Значения по умолчанию многих переменных, определяемых в
	    этом файле, изменились;  в частности, некоторые сервисы,
	    которые были включены по умолчанию в &release.4x;, теперь отключены
	    по умолчанию в &release.5x;.</para>
	</listitem>

	<listitem>

	  <para>Удалите оставшиеся файлы
	    <application>BIND 8</application>:</para>

	    <screen>&prompt.root; <userinput>rm /usr/bin/dnskeygen /usr/bin/dnsquery</userinput>
&prompt.root; <userinput>rm /usr/libexec/named-xfer</userinput>
&prompt.root; <userinput>rm /usr/sbin/named.restart /usr/sbin/ndc</userinput></screen>
 	</listitem>

        <listitem>
	  <para>Перезагрузитесь.</para>
        </listitem>
      </orderedlist>

      <para>После обновления базовой системы,
	обычно требуется обновление некоторых компонент, не входящих в
	базовую систему, для восстановления нормальной функциональности.
	<application>Perl</application> более не является частью
	базовой системы и должен быть установлен из коллекции
	портов (а именно, из порта <filename
	role="package">lang/perl5.8</filename>) или из пакета.
	После этой установки все порты и/или пакеты, зависящие от
	<application>Perl</application>, нуждаются в переустановке.</para>

      <para>Для запуска бинарных файлов &os; &release.4x; требуется набор
	библиотек, поддерживающих совместимость.  Он доступен
	после установки пакета/порта <filename
	role="package">misc/compat4x</filename>.</para>

      <para>Как было упомянуто в предыдущем разделе,
	<application>&xorg;</application> это реализация
	X Window System по умолчанию.  Коллекция портов
	(а также пакеты) соответствуют этому изменению, чтобы
	учесть зависимости.  Для замены установленной
	графической системы с <application>&xfree86;</application> на
	<application>&xorg;</application>, обратитесь к разделу
	<ulink url="&url.books.handbook;/x-install.html">Установка
	X11</ulink> Руководства &os;.</para>

    </sect2>
  </sect1>

  <sect1 id="summary">

    <title>Итоги</title>

    <para>В этой статье представлены некоторые из наиболее заметных
      новых возможностей &os; &release.5x;, и список отдельных
      вопросов, требующих особого внимания тех пользователей,
      кто обновляет существующую систему &os; &release.4x;.
      Здесь также представлены два набора инструкций по обновлению,
      одна с использованием обычной установки, другая
      основана на перекомпиляции системы из исходных
      текстов.</para>

  </sect1>
</article>
