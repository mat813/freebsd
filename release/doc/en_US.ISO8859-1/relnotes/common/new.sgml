<articleinfo>
  <title>&os;/&arch; &release.current; Release Notes</title>

  <corpauthor>The &os; Project</corpauthor>

  <pubdate>$FreeBSD$</pubdate>

  <copyright>
    <year>2000</year>
    <year>2001</year>
    <year>2002</year>
    <year>2003</year>
    <year>2004</year>
    <year>2005</year>
    <holder role="mailto:doc@FreeBSD.org">The &os; Documentation Project</holder>
  </copyright>

  <abstract>
    <para>The release notes for &os; &release.current; contain a summary
      of the changes made to the &os; base system since &release.prev;.
      This document lists applicable security advisories that were issued since
      the last release, as well as significant changes to the &os;
      kernel and userland.
      Some brief remarks on upgrading are also presented.</para>
  </abstract>
</articleinfo>

<sect1 id="intro">
  <title>Introduction</title>

  <para>This document contains the release notes for &os;
    &release.current; on the &arch.print; hardware platform.  It
    describes recently added, changed, or deleted features of &os;.
    It also provides some notes on upgrading
    from previous versions of &os;.</para>

<![ %release.type.snapshot [

  <para>The &release.type; distribution to which these release notes
    apply represents a point along the &release.branch; development
    branch between &release.prev; and the future &release.next;.  Some
    pre-built, binary &release.type; distributions along this branch
    can be found at <ulink url="&release.url;"></ulink>.</para>

]]>

<![ %release.type.release [

  <para>This distribution of &os; &release.current; is a
    &release.type; distribution.  It can be found at <ulink
    url="&release.url;"></ulink> or any of its mirrors.  More
    information on obtaining this (or other) &release.type;
    distributions of &os; can be found in the <ulink
    url="&url.books.handbook;/mirrors.html"><quote>Obtaining
    &os;</quote> appendix</ulink> to the <ulink
    url="&url.books.handbook;/">&os;
    Handbook</ulink>.</para>

]]>

  <para>All users are encouraged to consult the release errata before
    installing &os;.  The errata document is updated with
    <quote>late-breaking</quote> information discovered late in the
    release cycle or after the release.  Typically, it contains
    information on known bugs, security advisories, and corrections to
    documentation.  An up-to-date copy of the errata for &os;
    &release.current; can be found on the &os; Web site.</para>

</sect1>

<sect1 id="new">
  <title>What's New</title>

  <para>This section describes
    the most user-visible new or changed features in &os;
    since &release.prev;.
    In general, changes described here are unique to the &release.branch;
    branch unless specifically marked as &merged; features.
  </para>

  <para>Typical release note items
    document recent security advisories issued after
    &release.prev.historic;,
    new drivers or hardware support, new commands or options,
    major bug fixes, or contributed software upgrades.  They may also
    list changes to major ports/packages or release engineering
    practices.  Clearly the release notes cannot list every single
    change made to &os; between releases; this document focuses
    primarily on security advisories, user-visible changes, and major
    architectural improvements.</para>

  <sect2 id="security">
    <title>Security Advisories</title>

    <para>A bug in the &man.fetch.1; utility, which allows
      a malicious HTTP server to cause arbitrary portions of the client's
      memory to be overwritten, has been fixed.
      For more information, see security advisory
      <ulink url="ftp://ftp.FreeBSD.org/pub/FreeBSD/CERT/advisories/FreeBSD-SA-04:16.fetch.asc">FreeBSD-SA-04:16.fetch</ulink>.
      </para>

    <para>A bug in &man.procfs.5; and &man.linprocfs.5;
      which could allow a malicious local user to read parts of kernel
      memory or perform a local
      denial of service attack by causing a system panic,
      has been fixed.
      For more information, see security advisory
      <ulink url="ftp://ftp.FreeBSD.org/pub/FreeBSD/CERT/advisories/FreeBSD-SA-04:17.procfs.asc">FreeBSD-SA-04:17.procfs</ulink>.
      </para>

  </sect2>

  <sect2 id="kernel">
    <title>Kernel Changes</title>

    <para arch="alpha,amd64,i386">The loader tunable <varname>debug.mpsafevm</varname>
      has been enabled by default.</para>

    <!-- Above this line, sort kernel changes by manpage/keyword-->

    <para>A number of bugs have been fixed in the ULE
      scheduler.</para>

    <para arch="i386">A bug in Inter-Processor Interrupt (IPI)
      handling, which could cause SMP systems to crash under heavy
      load, has been fixed.  More details are contained in errata note
      <ulink url="ftp://ftp.FreeBSD.org/pub/FreeBSD/ERRATA/notices/FreeBSD-EN-05:03.ipi.asc">FreeBSD-EN-05:03.ipi</ulink>.
      </para>

    <para arch="i386">Memory allocation for legacy PCI bridges has
      been limited to the top 32MB of RAM.  Many older, legacy bridges
      only allow allocation from this range.  This change only appies
      to devices which don't have their memory assigned by the BIOS.
      This change fixes the <quote>bad Vcc</quote> error of CardBus
      bridges (&man.pccbb.4;).</para>

    <sect3 id="boot">
      <title>Boot Loader Changes</title>

      <para></para>
    </sect3>

    <sect3 id="proc">
      <title>Hardware Support</title>

      <para arch="sparc64">The &man.auxio.4; driver has been to drive
	some auxiliary I/O functions found on various SBus/EBus
	&ultrasparc; models.</para>

      <para>A framework for flexible processor speed control has been
	added.  It provides methods for various drivers to control CPU
	power utilization by adjusting the processor speed.  More
	details can be found in the &man.cpufreq.4; manual page.</para>

      <para arch="sparc64">The rtc driver has been added to support
	the MC146818-compatible clock found on some &ultrasparc; II
	and III models.</para>

      <para arch="sparc64">The &man.uart.4; driver is now enabled in
	the <filename>GENERIC</filename> kernel, and is now the
	default driver for serial ports.  The ofw_console,
	&man.sab.4;, and zs drivers are now disabled in the
	<filename>GENERIC</filename> kernel.</para>

      <sect4 id="mm">
	<title>Multimedia Support</title>

	<para arch="sparc64">The &man.snd.audiocs.4; driver has been
	  added to support the Crystal Semiconductor CS4231 audio
	  controller found on &ultrasparc; workstations.</para>

      </sect4>

      <sect4 id="net-if">
	<title>Network Interface Support</title>

	<para>The &man.cp.4; driver is now MPSAFE.</para>

	<para>The &man.ctau.4; driver is now MPSAFE.</para>

	<para>The &man.cx.4; driver is now MPSAFE.</para>

	<para>In the &man.em.4; driver, hardware support for VLAN
	  tagging is now disabled by default due to some interactions
	  between this feature and promiscuous mode.</para>

	<para>Ethernet flow control is now disabled by default in the
	  &man.fxp.4; driver, to prevent problems with a system panics
	  or is left in the kernel debugger.</para>

	<para>The &man.hme.4; driver is now MPSAFE.</para>

	<para arch="amd64">The &man.ndis.4; device driver wrapper now
	  supports &windows;/x86-64 binaries on amd64
	  systems.</para>

	<para>The &man.sf.4; driver now has support for device polling
	  and &man.altq.4;.</para>

	<para>Several programming errors in the &man.sk.4; driver have
	  been corrected.  These bugs were particular to SMP systems, and
	  could cause panics, page faults, aborted SSH connections, or
	  corrupted file transfers.  More details can be found in
	  errata note
	  <ulink url="ftp://ftp.FreeBSD.org/pub/FreeBSD/ERRATA/notices/FreeBSD-EN-05:02.sk.asc">FreeBSD-EN-05:02.sk</ulink>.
	  </para>

	<para>The &man.sk.4; driver now has support for &man.altq.4;.
	  This driver also now supports jumbo frames on Yukon-based
	  interfaces.</para>

      </sect4>
    </sect3>

    <sect3 id="net-proto">
      <title>Network Protocols</title>

      <para>The MTU feedback in IPv6 has been disabled when the sender writes
	data that must be fragmented.</para>

      <para>Ongoing work is reducing the use of the Giant lock by the
	network protocol stack and improving the locking
	strategies.</para>

      <para>A new &man.ng.netflow.4; NetGraph node allows a router
	running &os; to do NetFlow version 5 exports.</para>

      <para>The &man.sppp.4; driver now includes Frame Relay
	support.</para>

      <para>A bug in TCP that sometimes caused RST packets to
	be ignored if the receive window was zero bytes has been
	fixed.</para>

      <para>Several bugs in the TCP SACK implementation have been
	fixed.</para>

      <para>Random ephemeral port number allocation has led to some
        problems with port reuse at high connection rates.  This
        feature is now disabled during periods of high connection
        rates; whenever new connections are created faster than
        <varname>net.inet.ip.portrange.randomcps</varname> per second,
        port number randomization is disabled for the next
        <varname>net.inet.ip.portrange.randomtime</varname>
        seconds.  The default values for these two sysctl variables
        are <literal>10</literal> and <literal>45</literal>,
        respectively.</para>

    </sect3>

    <sect3 id="disks">
      <title>Disks and Storage</title>

      <para>The &man.amr.4; driver is now safe for use on systems
	using &man.pae.4;.</para>

      <para>The &man.hptmv.4; driver, which supports the HighPoint
	RocketRAID 182x series, has been added.</para>

      <para>The &man.matcd.4; driver has been removed.</para>

      <para>Information about newly-mounted cd9660 file systems (such
	as the presence of Rockridge extensions) is now only printed
	if the kernel was booted in verbose mode.  This change was
	made to reduce the amount of (generally unnecessary) kernel
	log messages.</para>

    </sect3>

    <sect3 id="fs">
      <title>File Systems</title>

      <para>A kernel panic in the NFS server has been fixed.  More
	details can be found in errata note 
	<ulink url="ftp://ftp.FreeBSD.org/pub/FreeBSD/ERRATA/notices/FreeBSD-EN-05:01.nfs.asc">FreeBSD-EN-05:01.nfs</ulink>.
	</para>

    </sect3>

    <sect3>
      <title>Contributed Software</title>

      <para><application>ACPI-CA</application> has been updated from
	20040527 to 20041119.</para>

    </sect3>
  </sect2>

  <sect2 id="userland">
    <title>Userland Changes</title>

    <para>The <literal>create</literal> command of the &man.gpt.8;
      utility now supports a <option>-f</option> command-line flag to
      force creation of a GPT even when there is an MBR record on a
      disk.</para>

    <para>The <filename>libarchive</filename> library (as well as the
      &man.tar.1; command that uses it) now has support for reading ISO
      images (with optional RockRidge extensions) and ZIP archives
      (with <literal>deflate</literal> and <literal>none</literal>
      compression).</para>

    <para>A number of bugfixes for <filename>libpthread</filename>
      have been merged from HEAD.</para>

    <para>The &man.moused.8; daemon now supports <quote>virtual
      scrolling</quote>, in which mouse motions made while holding
      down the middle mouse button are interpreted as scrolling.  This
      feature is enabled with the <option>-V</option>
      flag.</para>

    <para>The <literal>NO_NIS</literal> compile-time knob for userland
      has been added.  As its name implies, enabling this
      <filename>Makefile</filename> variable will cause NIS support to
      be excluded from various programs and will cause the NIS
      utilities to not be built.</para>

    <para>The &man.ncal.1; utility now supports a <option>-m</option>
      flag to generate a calendar for a specified month in the current
      year.</para>

    <para>The &man.ppp.8; program now implements an
      <option>echo</option> parameter, which allows LCP ECHOs to be
      enabled independently of LQR reports.  Older versions of
      &man.ppp.8; would revert to LCP ECHO mode on negotiation
      failure.  It is now necessary to specify <command>enable
      echo</command> to get this behaviour.</para>

    <para>The &man.rm.1; utility now supports an <option>-I</option>
      option that asks for confirmation (once) if recursively
      removing directories or if more than 3 files are listed in the
      command line.</para>

    <para>The &man.syslog.3; function is now thread-safe.</para>

    <para>The &man.syslogd.8; utility now opens an additional domain
      socket (<filename>/var/run/logpriv</filename> by default),
      with <literal>0600</literal> permissions to be used
      by privileged programs.  This prevents privileged
      programs from locking when the domain sockets
      run out of buffer space due to a
      local denial-of-service attack.</para>

    <para>The <option>-f</option> option of &man.tail.1; utility
      now supports more than one file at a time.</para>

    <para>&man.whois.1; now supports
      a <option>-k</option> flag
      for querying <hostid role="fqdn">whois.krnic.net</hostid>
      (the National Internet Development Agency of Korea),
      which holds details of IP address allocations within
      Korea.</para>

    <sect3 id="rc-scripts">
      <title><filename>/etc/rc.d</filename> Scripts</title>

      <para></para>
    </sect3>
  </sect2>

  <sect2 id="contrib">
    <title>Contributed Software</title>

    <para>A snapshot of <application>netcat</application> from OpenBSD
      as of 4 February 2005 has been added.  More information can be
      found in the &man.nc.1; manual page.</para>

    <para><application>sendmail</application> has been updated from
      version 8.13.1 to version 8.13.3.</para>

    <para>The timezone database has been updated from
      <application>tzdata2004e</application> to
      <application>tzdata2004g</application>.</para>

    <para></para>
  </sect2>

  <sect2 id="ports">
    <title>Ports/Packages Collection Infrastructure</title>

    <para>The
      <filename>ports/INDEX<replaceable>*</replaceable></filename>
      files, which kept an index of all of the entries in the ports
      collection, have been removed from the CVS repository.
      These files were generated only infrequently, and therefore were
      usually out-of-date and inaccurate.  Users requiring an index
      file (such as for use by programs such as &man.portupgrade.1;)
      have two alternatives for obtaining a copy:</para>

    <itemizedlist>
      <listitem>
	<para>Build an index file based on the current ports tree by
	  running <command>make index</command> from the top of the
	  <filename>ports/</filename> tree.</para>
      </listitem>

      <listitem>
	<para>Fetch an index file over the network by running
	  <command>make fetchindex</command> from the top of the
	  <filename>ports/</filename> tree.  This index file will
	  (typically) be accurate to within a day.</para>
      </listitem>
    </itemizedlist>

  </sect2>

  <sect2 id="releng">
    <title>Release Engineering and Integration</title>

    <para>The supported version of the
      <application>GNOME</application> desktop environment has been
      updated from 2.6.2 to 2.8.3.

      <note>
	<para>Users of older versions of the
	  <application>GNOME</application> desktop
	  (<filename role="package">x11/gnome2</filename>)
	  must take particular care in upgrading.  Simply upgrading it
	  from the &os; Ports Collection with &man.portupgrade.1;
	  (<filename role="package">sysutils/portupgrade</filename>)
	  will cause serious problems.
	  <application>GNOME</application> desktop users should read
	  the instructions carefully at
	  <ulink url="&url.base;/gnome/docs/faq28.html"></ulink>
	  and use the
	  <ulink url="&url.base;/gnome/gnome_upgrade.sh"><filename>gnome_upgrade.sh</filename></ulink>
	  script to properly upgrade to
	  <application>GNOME</application> 2.8.3.</para>

	<para>For casual users of the various
	  <application>GNOME</application> libraries,
	  &man.portupgrade.1; should be sufficient.</para> </note>
      </para>

    <para>The supported version of the <application>KDE</application>
      desktop environment has been updated from 3.3.0 to
      3.3.2.</para>

    <para>The supported version of <application>Xorg</application> has
      been updated from 6.7.0 to 6.8.1.</para>

  </sect2>

  <sect2 id="doc">
    <title>Documentation</title>

    <para></para>

  </sect2>
</sect1>

<sect1 id="upgrade">
  <title>Upgrading from previous releases of &os;</title>

  <para>Users with existing &os; systems are
    <emphasis>highly</emphasis> encouraged to read the <quote>Early
    Adopter's Guide to &os; &release.current;</quote>.  This document generally has
    the filename <filename>EARLY.TXT</filename> on the distribution
    media, or any other place that the release notes can be found.  It
    offers some notes on upgrading, but more importantly, also
    discusses some of the relative merits of upgrading to &os;
    5.<replaceable>X</replaceable> versus running &os;
    4.<replaceable>X</replaceable>.</para>

  <important>
    <para>Upgrading &os; should, of course, only be attempted after
      backing up <emphasis>all</emphasis> data and configuration
      files.</para>
  </important>
</sect1>
