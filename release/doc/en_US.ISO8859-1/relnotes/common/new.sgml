<!--
	The "What's New" section of the release notes.  Within
	each subsection (i.e. kernel, security, userland), list
	items in chronological order, unless necessary to keep
	related items together, such as multiple release notes
	pertaining to a single program or module.

-->

<sect1>
  <sect1info>
    <pubdate>$FreeBSD$</pubdate>
  </sect1info>

  <title>What's New</title>

  <para>This section describes the most user-visible new or changed
  features in &os; since &release.prev;.</para>

  <para>Many additional changes were made to &os; that are not listed
  here for lack of space.  For example, documentation was corrected
  and improved, minor bugs were fixed, insecure coding practices were
  audited and corrected, and source code was cleaned up.</para>

  <para>The release notes items are organized into three different
  sections.  <xref linkend="kernel"> lists recent changes to the &os;
  kernel.  Security fixes, including those pertaining to security
  advisories, are listed in <xref linkend="security">.  Finally, <xref
  linkend="userland"> covers changes to &os; userland applications
  included in the base system.</para>

  <sect2 id="kernel">
    <title>Kernel Changes</title>

    <para>The <literal>O_DIRECT</literal> flag has been added to
    &man.open.2; and &man.fcntl.2;.  Specifying this flag for open
    files will attempt to minimize the cache effects of reading and
    writing.</para>

    <para>An &man.orm.4; device has been added to claim the option
    ROMs in the ISA memory I/O space, to prevent other drivers from
    mistakenly assigning addresses that conflict with these ROMs.</para>

    <para>The out-of-swap process termination code now begins killing
    processes earlier to avoid deadlocks; it now also takes into
    account the swap space used by processes when computing the
    process sizes.</para>

    <para>Network device cloning has been implemented, and the &man.gif.4;
    device has been modified to take advantage of it.
    Thus, instead of specifying how many &man.gif.4; interfaces
    are available in kernel configuration files, &man.ifconfig.8;'s
    <option>create</option> option should be used when another device
    instance is desired.</para>

    <para>Two new &man.ddb.4; commands, <command>hwatch</command> and
    <command>dhwatch</command>, have been introduced.  Analogous to
    <command>watch</command> and <command>dwatch</command>, they install
    hardware watchpoints (as opposed to software watchpoints) if supported
    by the architecture.</para>

    <para>The <literal>tcpmssfixup</literal> &man.ppp.8; option now
    adjusts the maximum receive segment size of incoming TCP SYN
    segments as well as outgoing TCP SYN segments.</para>

    <sect3>
      <title>Processor/Motherboard Support</title>

      <para arch="i386">Detection for new processors, such as the
      Transmeta Crusoe, and Transmeta Crusoe with LongRun, has been
      added.</para>

    </sect3>

    <sect3>
      <title>Network Interface Support</title>

      <para>The &man.fxp.4; driver now requires a <literal>device
      miibus</literal> entry in the kernel configuration file.</para>

      <para>The &man.wx.4; driver now supports the Intel PRO1000-F and
      PRO1000-T (10/100/1000) adapters.</para>
      
      <para>The &man.an.4; driver has received a few bug fixes;
      promiscuous mode now works, and it can be configured before being
      brought <literal>up</literal>.</para>

      <para>The &man.xl.4; driver now supports reception of VLAN
      tagged frames (on the <quote>Cyclone</quote> or newer
      chipsets).</para>

      <para>The &man.ti.4; driver correctly masks VLAN tags.</para>

      <para>Added the &man.nge.4; driver, which supports PCI Gigabit
      Ethernet adapters based on the National Semiconductor DP83820
      and DP83821 Gigabit Ethernet controller chips, including the
      D-Link DGE-500T, SMC EZ Card 1000 (SMC9462TX), Asante
      FriendlyNet GigaNIC 1000TA and 1000TPC and Addtron
      AEG320T.  This driver supports transmit and receive checksum
      offloading.</para>

      <para>The &man.lge.4; driver has been added to support the Level
      1 LXT1001 NetCellerator Gigabit Ethernet controller chip. This
      device is used on some fiber optic GigE cards from SMC, D-Link
      and Addtron.  Jumbograms and TCP/IP checksum offload on receive
      are supported, although hardware VLAN filtering is not.</para>

      <para>The &man.tx.4; driver now supports the fiber-optic
      SMC 9432FTX NICs.</para>

      <para>The &man.ed.4; driver now has support for D-Link
      DL10022 chips, necessary for the NetGear FA-410TX and other
      cards.  As a result, <literal>device miibus</literal> is
      required in kernel configurations using the &man.ed.4;
      driver.</para>

      <para>The &man.txp.4; driver has been added to support NICs
      based on the 3Com 3XP Typhoon/Sidewinder (3CR990) chipset.</para>
    </sect3>

    <sect3>
      <title>Network Protocols</title>

      <para>TCP now has RFC 1323 extensions enabled by default in
      &man.rc.conf.5;.</para>

      <para>RFC 1323 and RFC 1644 TCP extensions are now disabled for a
      connection in progress if no response has been received by the
      third SYN segment sent.  This behavior tries to work around
      (very old) terminal servers with buggy VJ header compression
      implementations.</para>

      <para>The <literal>TCP_RESTRICT_RST</literal> kernel option has
      been removed.  Similar functionality can be achieved with the
      <varname>net.inet.tcp.blackhole</varname> sysctl
      variable.</para>

      <para>The TCP implementation no longer requires the
      allocation of a TCP template structure for each connection; this
      should reduce the buffer usage on large systems handling many
      connections.</para>

      <para>A new <literal>options RANDOM_IP_ID</literal> kernel
      option causes the ID field of IP packets to be randomized.  This
      closes a minor information leak which allows a remote observer
      to determine the rate at which the machine is generating
      packets, since the default behaviour is to increment a counter
      for each packet sent.</para>

    </sect3>

    <sect3>
      <title>Disks and Storage</title>

      <para>The &man.ata.4; driver again has write-caching enabled by 
      default.</para>
    </sect3>

    <sect3>
      <title>Filesystems</title>

      <para arch="i386">smbfs (CIFS) support in kernel has been
      added.  The corresponding userland filesystem mount utility can be found 
      in the <filename>net/smbfs</filename> port in the &os; Ports 
      Collection. </para>

      <para>A simple hash-based lookup optimization for large directories
      called <literal>dirhash</literal> has been added.  Conditional on the
      <literal>UFS_DIRHASH</literal> kernel option, it improves the speed
      of operations on very large directories at the expense of some
      memory.</para>

    </sect3>

    <sect3>
      <title>Multimedia Support</title>

      <para arch="i386">A driver for the Advance Logic ALS4000 has
      been added.</para>

    </sect3>

    <sect3>
      <title>Contributed Software</title>

      <para><application>IPFilter</application> has been updated to
      3.4.20.</para>

      <sect4 id="kame-kernel">
        <title>KAME</title>

        <para>The IPv6 stack is now based on a snapshot based on the KAME
	Project's IPv6 snapshot as of 28 May, 2001.  Most of the
	items listed in this section are a result of this import.
	<xref linkend="kame-userland"> lists userland updates to the
	KAME IPv6 stack.</para>

        <para>&man.gif.4; is now based on RFC 2893, rather than RFC
	1933.  The <literal>IFF_LINK2</literal> interface flag can
	be used to control ingress filtering.</para>

	<para><application>IPSec</application> has received some
	enhancements, including the ability to use the Rijndael and
	SHA2 algorithms.  IPSec RC5 support has been removed due to
	patent issues.</para>

	<para>&man.stf.4; now conforms to RFC 3056; the
	<literal>IFF_LINK2</literal> interface flag can be used to
	control ingress filtering.</para>

	<para>IPv6 has better checking of illegal addresses (such as
	loopback addresses) on physical networks.</para>

	<para>The <varname>IPV6_V6ONLY</varname> socket option is
	now completely supported.  The kernel's default behavior
	with respect to this option is controlled by the
	<varname>net.inet6.ip6.v6only</varname> sysctl
	variable.</para>

	<para>RFC 3041 (Privacy Extensions for Stateless Address
	Autoconfiguration) is now supported.  It can be enabled via
	the <varname>net.inet6.ip6.use_tempaddr</varname> sysctl
	variable.</para>
      </sect4>
    </sect3>
  </sect2>
  <sect2 id="security">
    <title>Security Fixes</title>

    <para>The security fix mentioned in security advisory
    FreeBSD-SA-01:39, which governs initial sequence number generation
    for TCP connections, has raised some possible compatability
    issues.  To mitigate this effect, the fix can now be enabled or
    disabled using the
    <varname>net.inet.tcp.tcp_seq_genscheme</varname> sysctl
    variable.</para>

    <para>A vulnerability in the &man.fts.3; routines (used by
    applications for recursively traversing a filesystem) could
    allow a program to operate on files outside the intended directory
    hierarchy.  This bug has been fixed (see security advisory
    FreeBSD-SA-01:40).</para>

    <para>The portmapper, <filename>/usr/sbin/portmap</filename>, is now
    turned off by default.  However, if you turn on NFS server, NIS services,
    or Amd; the portmapper will still be started.</para>

    <para>The new <varname>net.inet.ip.maxfragpackets</varname> 
    and <varname>net.inet.ip.maxfragpackets</varname> sysctl
    variables limit the amount of memory that can be consumed by IPv4
    and IPv6 packet fragments, which defends against some denial of service
    attacks.</para>

    <para>A flaw allowed some signal handlers to remain in effect in a
    child process after being exec-ed from its parent.  This allowed
    an attacker to execute arbitrary code in the context of a setuid
    binary.  This flaw has been corrected (see security advisory
    FreeBSD-SA-01:42).</para>

    <para>A remote buffer overflow in &man.tcpdump.1; has been fixed
    (see security advisory FreeBSD-SA-01:48).</para>

    <para>A remote buffer overflow in &man.telnetd.8; has been
    fixed (see security advisory FreeBSD-SA-01:49).</para>
  </sect2>
  <sect2 id="userland">
    <title>Userland Changes</title>

    <para>&man.ip6fw.8; now has the ability to use a preprocessor and
    use the <option>-q</option> (quiet) flag when reading from a file.</para>

    <para>&man.ping.8; now supports a <option>-m</option> option to
    set the TTL of outgoing packets.</para>

    <para>&man.ln.1; now takes a <option>-h</option> flag to avoid
    following a target that is a link, with a <option>-n</option> flag
    for compatability with other implementations.</para>

    <para>&man.find.1; now has the <option>-anewer</option>,
    <option>-cnewer</option>, <option>-mnewer</option>,
    <option>-okdir</option>, and <option>-newer[acm][acmt]</option>
    primaries for comparisons of file timestamps.</para>

    <para>The performance of the ELF dynamic linker has been
    improved.</para>

    <para>&man.ifconfig.8; can now accept addresses in slash/CIDR
    notation.</para>

    <para>&man.c89.1; has been converted from a shell script to a
    binary executable, fixing some minor bugs.</para>

    <para>&man.vidcontrol.1; now supports a <option>-p</option> to
    take a snapshot of a &man.syscons.4; video buffer.  These
    snapshots can be manipulated by some of the
    <filename>scr2*</filename> utilities in the Ports
    Collection.</para>

    <para>&man.vidcontrol.1; now allows the user to omit the font size
    specification when loading a font, and has some better
    error-handling.</para>

    <para>&man.telnet.1; now supports a <option>-u</option> flag to
    allow connections to UNIX-domain (<literal>AF_UNIX</literal>)
    sockets.</para>

    <para>&man.newfs.8; now takes a <option>-U</option> option to
    enable softupdates on a new filesystem.</para>

    <para><filename>libcrypt</filename> now has support for Blowfish
    password hashing.</para>

    <para>Ukranian language support has been added to the &os;
    console.</para>

    <para>&man.savecore.8; now works correctly on machines with 2 GB
    or more of RAM.</para>

    <para>The syntax of &man.inetd.8;'s support for &man.faithd.8; is
    now compatable with that of other BSDs.</para>

    <para>The <literal>ident</literal> protocol support in &man.inetd.8; has
    been cleaned up and updated.</para>

    <para>&man.inetd.8; now has the ability to manage UNIX-domain
    sockets.</para>

    <para>The &man.resolver.3; in &os; now implements EDNS0 support,
    which will be necessary when working with IPv6 transport-ready
    resolvers/DNS servers.</para>

    <para>&man.df.1; now takes a <option>-l</option> option to only
    display information about locally-mounted filesystems.</para>

    <para>&man.whois.1; now directs queries for IP addresses to
    ARIN.</para>

    <para>The <option>-T</option> to &man.dump.8; no longer swallows
    an extra argument.</para>

    <para>&man.dump.8; has a new <option>-D</option> option, allowing
    the path to the <filename>/etc/dumpdates</filename> file to be
    changed.</para>

    <para><filename>libfetch</filename> now has support for a
    <varname>HTTP_USER_AGENT</varname> environment variable.</para>

    <para>The &man.getprogname.3; and &man.setprogname.3; library
    functions have been added to manipulate the name of the current
    program.  They are used by error-reporting routines to produce
    consistent output.</para>

    <para>&man.xargs.1; gained a <option>-J</option> option which allows
    the user to specify exactly where in the command line the input should
    be retrofitted.</para>

    <para>&man.ifconfig.8; now has support for setting parameters for
    IEEE 802.11 wireless network devices.  &man.wi.4; and
    &man.an.4; devices are supported.</para>

    <para>&man.ifconfig.8; no longer displays the list of supported
    media by default.  Instead it displays it when the
    <option>-m</option> is given.</para>

    <para>&man.lpd.8; now takes two new options:  <option>-c</option>
    will log all connection errors to &man.syslogd.8;, while
    <option>-w</option> will allow connections from non-reserved
    ports.</para>

    <para>&man.lpc.8; has been improved; <command>lpc clean</command>
    is now somewhat safer, and a new <command>lpc tclean</command>
    command has been added to check to see what files would be removed
    by <command>lpc clean</command>.</para>

    <para>&man.du.1; now takes a <option>-I</option> command-line flag
    to ignore/skip files and subdirectories matching a specified
    shell-glob mask.</para>

    <para>&man.growfs.8;, a utility for growing FFS filesystems, has
    been added.  &man.ffsinfo.8;, a utility for dump all the
    meta-information of an existing filesystem, has also been
    added.</para>

    <para>&man.mail.1; now takes a <option>-E</option> flag to avoid
    sending messages with empty bodies.</para>

    <para>&man.vidcontrol.1; now supports a <option>-C</option> option to
    clear the history buffer for a given tty.</para>

    <para>&man.last.1; now implements a <option>-d</option> that provides a
    <quote>snapshot</quote> of who was logged in at a particular date and
    time.</para>

    <para><filename>libcrypt</filename> and
    <filename>libdescrypt</filename> have been unified to provide a
    configurable password authentication hash library.  Both the md5
    and des hash methods are provided unless the des hash is
    specifically compiled out.</para>

    <para>&man.install.1; has a number of new features, including the
    <option>-b</option> and <option>-B</option> options for backing up
    existing target files and the <option>-S</option> option for
    <quote>safe</quote> (atomic copy) operation.  The
    <option>-c</option> (copy) flag is now the default, and the
    <option>-D</option> (debugging) flag has been withdrawn.
    &man.install.1; now issues a warning if <option>-d</option>
    (create directories) and <option>-C</option> (copy changed files
    only) are used together.</para>

    <para>The &os; <filename>Makefile</filename> infrastructure now
    supports the <varname>WARNS</varname> directive from NetBSD.  This
    directive controls the addition of compiler warning flags to
    <varname>CFLAGS</varname> in a relatively compiler-neutral
    manner.</para>

    <sect3>
      <title>Contributed Software</title>

      <para><application>BIND</application> is now built with the
      <literal>NOADDITIONAL</literal> flag, which causes &man.named.8;
      to operate in a more consistent fashion for certain common
      misconfigurations.</para>

      <para><application>Binutils</application> have been upgraded to
      2.11.2.</para>

      <para>The &man.ee.1; <application>Easy Editor</application> has
      been updated to 1.4.2.</para>

      <para>&man.gcc.1; now supports the environment variable
      <varname>GCC_OPTIONS</varname>, which can hold a set of default
      options for <application>GCC</application>.</para>

      <para><application>GNATS</application> has been updated to
      3.113.</para>

      <para><application>groff</application> and its related utilities
      have been updated to FSF version 1.17. This import brings in a
      new &man.mdoc.7; macro package (sometimes referred to as
      <literal>mdocNG</literal>), which removes many of the
      limitations of its predecessor.</para>

      <para><application>OpenSSL</application> has been upgraded to
      0.9.6a.</para>

      <para><application>sendmail</application> and associated utilities
      have been upgraded to version 8.11.5.  See
      <filename>/usr/src/contrib/sendmail/RELEASE_NOTES</filename>
      for more information.</para>

      <para>&man.traceroute.8; now takes its default maximum TTL value
      from the <varname>net.inet.ip.ttl</varname> sysctl
      variable.</para>

      <para><application>tcpdump</application> has been updated to
      3.6.3.</para>

      <para><application>bzip2</application> 1.0.1 has been imported; this
      brings the &man.bzip2.1; program and the <filename>libbz2</filename>
      library to the base system.</para>

      <para><application>libpcap</application> has been updated to
      0.6.2.</para>

      <sect4 id="kame-userland">
        <title>KAME</title>

        <para>The IPv6 stack is now based on a snapshot based on the KAME
	Project's IPv6 snapshot as of 28 May, 2001.  Most of the
	items listed in this section are a result of this import.
	<xref linkend="kame-kernel"> lists kernel updates to the KAME
	IPv6 stack.</para>

	<para>&man.faithd.8; now supports a configuration file for
	access control.</para>

	<para>&man.ifconfig.8; can now perform the functions of
	&man.gifconfig.8;.</para>

	<para>&man.ifconfig.8; can now perform the functions of
	&man.prefix.8;.  &man.prefix.8; is now a shell script for
	partial backwards compatability.</para>

	<para>&man.ndp.8; now implements garbage collection for stale
	NDP entries, as described in RFC 2461 (Neighbor Discovery for
	IP Version 6 (IPv6)).</para>

        <para>&man.pim6dd.8; and &man.pim6sd.8; have been removed due to
        restrictive licensing conditions.  These programs are available
        in the ports collection as <filename>net/pim6dd</filename> and
        <filename>net/pim6dd</filename>.</para>

	<para>&man.route6d.8; now supports a <option>-n</option> flag
	to avoid updating the kernel forwarding table.</para>

	<para>The <option>-R</option> (router renumbering) option to
	&man.rtadvd.8; is currently ignored.</para>
      </sect4>
    </sect3>

    <sect3>
      <title>Ports/Packages Collection</title>

      <para>&man.pkg.version.1; now takes a <option>-s</option> flag
      to limit its operation to ports/packages matching a given
      string.</para>
    </sect3>

  </sect2>
</sect1>
