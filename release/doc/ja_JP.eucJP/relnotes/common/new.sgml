<!--
    FreeBSD Japanese Documentation Project

    $FreeBSD$

    Original revision: 1.22.2.419.2.9
-->

<articleinfo>
  <title>&os;/&arch; &release.current; リリースノート</title>

  <pubdate>$FreeBSD$</pubdate>

  <corpauthor>&os; プロジェクト</corpauthor>

  <copyright>
    <year>2000</year>
    <year>2001</year>
    <year>2002</year>
    <year>2003</year>
    <year>2004</year>
    <year>2005</year>
    <holder role="mailto:doc@FreeBSD.org">&os; ドキュメンテーションプロジェクト</holder>
  </copyright>

  <abstract>
    <para>この &os; &release.current; リリースノートには、
      &os; &release.prev; のリリース以降に &os;
      ベースシステムに対して加えられた変更点がまとめられています。
      変更点はカーネル、ユーザランドにおけるものだけでなく、
      前回のリリース以降に発行され、
      ベースシステムに影響のあるセキュリティ勧告も含まれています。
      また、アップグレードの際の注意点についても簡単に説明しています。</para>
  </abstract>
</articleinfo>

<sect1 id="intro">
  <title>はじめに</title>

  <para>この文書は &arch.print; アーキテクチャ版 &os; &release.current;
    のリリースノートです。
    これには &release.prev; 以降に追加 (変更)
    された新機能および、前のバージョンの &os;
    からアップグレードする場合におけるいくつかの注意点か書かれています。</para>

<![ %release.type.snapshot [

  <para>リリースノートが対象としているこの &release.type; は、
    &release.branch; 開発ブランチの
    &release.prev; と、リリースが予定されている
    &release.next; の中間点に対応します。
    このブランチにおける構築済みのバイナリ &release.type;
    は <ulink url="&release.url;"></ulink> から入手可能です。</para>

]]>

<![ %release.type.release [

  <para>この &os; &release.current は &release.type; 版であり、
    <ulink url="&release.url;"></ulink>
    および各ミラーサイトで公開されています。
    &os; の &release.type; 版 (またはそれ以外) の入手法については
    <ulink url="http://www.FreeBSD.org/doc/en_US.ISO8859-1/books/handbook/">FreeBSD
      ハンドブック</ulink>の<ulink url="http://www.FreeBSD.org/doc/en_US.ISO8859-1/books/handbook/mirrors.html">
      <quote>&os; を入手するには</quote></ulink>をご覧ください。</para>

]]>
</sect1>

<!--
       The "What's New" section of the release notes.

       Guidelines for new entries:

       1.  If there is some obvious "keyword" associated with an
       entry (such as a manpage entry or an application name), try to
       put it at the start of the sentence.

       2.  Within each subsection (i.e. kernel, security, userland),
       list items in alphabetical order by these keywords.

       Some entries will have no obvious keywords to help with
       ordering.  In sections containing these entries, put those
       containing (e.g.) manpage references first, then some
       suitable SGML comment line as a demarc, then the remaining
       entries.
-->

<sect1 id="new">
  <title>更新情報</title>

  <para>この節では &release.prev; 以降に新たに追加・変更された
    ユーザに影響する機能について説明します。
    リリースノートの項目には通常、新しいドライバや新しいハードウェアへの対応、
    新しいコマンドや新しいオプションの導入、
    大規模なバグ修正、寄贈ソフトウェアのアップグレードが含まれており、
    それに加えて
    &release.prev; 以降に発行され、
    ベースシステムに影響のあるセキュリティ勧告も記載されています。</para>

  <sect2 id="security">
    <title>セキュリティ勧告</title>

    <para>攻撃者がローカルからカーネルメモリの一部を読み書きできるような、
      &os; の Linux バイナリ互換機能におけるプログラム上の誤りが修正さ
      れました。詳細は、セキュリティ勧告
      <ulink url="ftp://ftp.FreeBSD.org/pub/FreeBSD/CERT/advisories/FreeBSD-SA-04:13.linux.asc">FreeBSD-SA-04:13.linux</ulink>
      をご覧ください。</para>

    <para><application>CVS</application> のサーバモードに、
      メモリの二重開放 (double-free)、整数演算のオーバフロー、
      バッファオーバフローなど、リモートから悪用できる
      数多くのセキュリティ上の弱点が発見されました。
      これらを悪用すると、情報の漏洩やサービス妨害攻撃が可能であり、
      さらに任意のコードの実行ができる危険性があります。この弱点は、
      <application>CVS</application> 1.11.17 への更新によって修正されました。
      詳細は、セキュリティ勧告
      <ulink url="ftp://ftp.FreeBSD.org/pub/FreeBSD/CERT/advisories/FreeBSD-SA-04:14.cvs.asc">FreeBSD-SA-04:14</ulink>
      (<ulink url="http://home.jp.freebsd.org/cgi-bin/showmail/announce-jp/1247">日本語訳</ulink>)
      をご覧ください。</para>

    <para>HTTP サーバがクライアントのメモリの任意の部分を上書きするこ
      とができるという、&man.fetch.1; ユーティリティのバグが修正されました。
      詳細は、セキュリティ勧告
      <ulink url="ftp://ftp.FreeBSD.org/pub/FreeBSD/CERT/advisories/FreeBSD-SA-04:16.fetch.asc">FreeBSD-SA-04:16</ulink>
      (<ulink url="http://home.jp.freebsd.org/cgi-bin/showmail/announce-jp/1257">日本語訳</ulink>)
      をご覧ください。</para>

    <para>悪意を持ったユーザが、ローカルからシステムをパニックさせて
      サービス妨害攻撃をおこなったり、カーネルメモリの一部を不正に読み出せる
      ような、&man.procfs.5; と &man.linprocfs.5; のバグが修正されました。
      詳細は、セキュリティ勧告
      <ulink url="ftp://ftp.FreeBSD.org/pub/FreeBSD/CERT/advisories/FreeBSD-SA-04:17.procfs.asc">FreeBSD-SA-04:17</ulink>
      (<ulink url="http://home.jp.freebsd.org/cgi-bin/showmail/announce-jp/1263">日本語訳</ulink>)
      をご覧ください。</para>
  </sect2>

  <sect2 id="kernel">
    <title>カーネルの変更点</title>

    <para arch="i386">Cronyx Tau-PCI 同期シリアルアダプタ用のドライバ
      &man.cp.4; が追加されました。</para>

    <para arch="alpha">&man.em.4; ドライバが
      インストールメディアのカーネルに追加されました。</para>

    <para><literal>PROT_NONE</literal> という状態のページが、
      ある条件下で読み出し可能になるという &man.mmap.2;
      のバグが修正されました。</para>

    <para>&os; 仮想メモリサブシステムの <function>vm_object_madvise()</function>,
      <function>vm_object_sync()</function>, <function>contigmalloc()</function>
      関数のバグが修正されました。
      <function>vm_object_madvise()</function> と
      <function>vm_object_sync()</function> のバグは、
      さまざまな条件でメモリ内容が壊れる可能性があるもので、
      <function>contigmalloc()</function> のバグは、
      システムをパニックさせる可能性があるものです。</para>

<!-- Above this line, kernel changes ordered by manpage/variable name -->

    <sect3 id="proc">
      <title>プラットフォーム固有のハードウェアの対応状況</title>

      <para arch="i386">モード 0 (simple I/O) で動作している Intel
	8255A PPI (programmable peripheral interface)
	チップに対応する &man.pbio.4; ドライバが追加されました。</para>

      <para arch="alpha">DS10 クラスのシステムでは、
	フロッピーインタフェースの対応に問題があります。
	カーネルはハードウェアを正しく検知するのですが、
	フロッピーが正常に動作しません。
	ただし、フロッピーからの起動とインストールは可能です。</para>
    </sect3>

    <sect3 id="net-if">
      <title>ネットワークインターフェイスの対応状況</title>

      <para>ASIX Electronics AX88172 USB 2.0 Ethernet
	チップセットに対応する &man.axe.4; ドライバが追加されました。</para>

      <para>&man.bge.4; ドライバが BCM5750 および BCM5751
	に対応しました。</para>

      <para>&man.em.4; ドライバが 82541ER および 82546GB
	デュアルポート PCI Express アダプタに対応しました。</para>

      <para>Intel 82597EX Ethernet コントローラチップベースの
	PCI ギガビット Ethernet アダプタに対応する
	&man.ixgb.4; ドライバが追加されました。</para>

      <para>Ethernet ハブのような単純なパケット分配を実現する
        Netgraph ノードタイプ &man.ng.hub.4; が追加されました。</para>

      <para>&man.sk.4; ドライバの jumbo
	フレームの処理にあったバグが修正されました。</para>

      <para>&man.vr.4; ドライバが &man.polling.4; に対応しました。</para>

      <para>インタフェース単位で制御可能な &man.polling.4;
	機能が実装されました。
	&man.polling.4; に対応しているすべてのネットワークドライバ
	(&man.dc.4;, &man.fxp.4;, &man.em.4;, &man.nge.4;, &man.re.4;,
	&man.rl.4;, &man.sis.4;, &man.ste.4;, &man.vr.4;)
	はこの機能に対応しており、&man.ifconfig.8;
	を使って制御できます。</para>

      <para><varname>net.inet.ip.rtexpire</varname> もしくは
	<varname>net.inet6.ip6.rtexpire</varname> が
	<literal>0</literal> に設定されている時に、
	システムがパニックする問題が修正されました。</para>

<!-- Above this line, order network driver changes by manpage/variable name-->

    </sect3>

    <sect3 id="net-proto">
      <title>ネットワークプロトコル</title>

      <para>一時ポート (ephemeral port)
	の割り当てを乱数を使っておこなうという、OpenBSD
	の持つ機能が実装されました。
	これはデフォルトで有効になっており、sysctl 変数
	<varname>net.inet.ip.portrange.randomized</varname>
	で無効にできます。ただし接続数の変化が速い場合には、
	この乱数化によってポート番号の再利用が非常に速くおこなわれるため、
	システムによってはそれが問題となることがあります。
	そこで、乱数を使ったポート番号によるセキュリティの向上と、
	正常な動作の両方を実現するため、
	接続数の変化が速くなった時点で機能を無効にするようになっています。
	具体的には、毎秒の接続数が sysctl 変数
	<varname>net.inet.ip.portrange.randomcps</varname>
	(デフォルトでは <literal>10</literal>) を超えた場合、
	乱数化は sysctl 変数
	<varname>net.inet.ip.portrange.randomtime</varname>
	で指定された秒数 (デフォルトは <literal>45</literal>)
	の間、無効になります。</para>

      <para>&man.ipfw.4; がルックアップテーブルに対応しました。
	この機能は広範囲の連続しないアドレス集合を扱うのに有用です。</para>

      <para>&man.ipnat.8; の redirect ルールが、
	TCP/UDP 以外のパケットについても動作するようになりました。</para>

      <para>&os; TCP スタックの <literal>RST</literal> の処理が、
	一般に使われている多くの TCP スタックとの互換性を維持しつつ、
	reset 攻撃を可能な限り困難にするように改良されました。
	これは、次のようなアルゴリズムを使っています。
	<literal>ESTABLISHED</literal> 状態の接続は、
	シーケンス番号が <varname>last_ack_sent</varname>
	と正確に一致する RST のみが受理され、
	それ以外のセグメントは何もせずに無視されます。
	それ以外の状態の接続の場合は、RST
	がウィンドウ内のどこにあっても受理されます。
	上記以外のセグメントは、何もせずに無視されます。
	ただし、これは RFC 793 の仕様に違反していることに注意してください。
	sysctl 変数 <varname>net.inet.tcp.insecure_rst</varname>
	を <literal>1</literal> に設定すれば、
	機能を無効にして従来の動作に戻すことが可能です。</para>
    </sect3>

    <sect3 id="disks">
      <title>ディスク・記憶装置</title>

      <para>IBM/Adaptec ServeRAID コントローラに対応する
	&man.ips.4; ドライバが追加されました。</para>

      <para>&man.mpt.4; ドライバが LSI Logic FC929X デュアル 2Gb/s
	Fibre Channel カードに対応しました。</para>

      <para>&man.trm.4; ドライバが DC395U2W アダプタに対応し、
	高負荷時の問題も修正されました。</para>
    </sect3>
  </sect2>

  <sect2 id="userland">
    <title>ユーザランドの変更点</title>

    <para>&man.cron.8 デーモンにジョブを開始する時間を変動させることが
      できるようになりました。<option>-j</option>
      オプションは特権を持たないユーザ、
      <option>-J</option> オプションはスーパユーザ用です。
      時間の変動というのは、&man.cron.8 がジョブを実行する前に、
      指定された範囲内で無作為に選ばれた、
      短い待ち時間が発生するという意味です。
      この機能は、多くのジョブが特定の瞬間に予定されている場合の負荷
      のピークを低減することを目的としたものです。</para>

    <para>&man.fwcontrol.8; に、デフォルトの <literal>fwmem</literal>
      ターゲットを指定する <option>-m</option>
      オプションが追加されました。</para>

    <para><varname>$inetd_flags</varname> 変数の初期設定に
      <option>-C 60</option> オプションが追加されました。</para>

    <para><application>libc</application> に、
      &man.eui64.3; 関数群が追加されました。</para>

    <para>&man.ngctl.8; に、Netgraph システム全体の
      <application>GraphViz</application> (.dot) 画像を生成する
      <command>dot</command> コマンドが追加されました。</para>

    <para>&man.ppp.8; の LQM (Link Quality Monitoring)
      対応が再実装されました。LQM は、PPP
      において、有効な回線の接続品質の監視を可能にするものです。
      詳細は RFC 1989 をご覧ください。</para>

    <para>ユーザランド &man.ppp.8; 実装が、
      定期的に RADIUS アカウント情報を RADIUS サーバに送信する
      <quote>set rad_alive <replaceable>N</replaceable></quote>
      コマンドに対応しました。</para>

    <para>ひとつのインタフェースに 2 つ以上の IP アドレスを割り当てている場合
      に正しく動作しなくなるという、
      &man.rarpd.8; のバグが修正されました。</para>

    <para>&man.syslogd.8; が <literal>LOG_NTP</literal> ファシリティに
      対応しました。</para>

    <para>&man.pax.1; に存在していた off-by-one エラー数個と、
      バッファオーバランの可能性がある部分が修正されました。</para>

    <para>&man.whois.1; が NORID (ノルウェーの最上位レジストリ)
      ハンドルとドイツの whois ネームサーバに対応し、
      韓国国内の IP アドレス割り当てを管理している
      <hostid role="fqdn">whois.krnic.net</hostid>
      (NIDA; National Internet Development Agency of Korea)
      に問い合わせるための <option>-k</option>
      フラグが追加されました。</para>

<!-- Above this line, order userland changes by manpage/variable name-->

  </sect2>

  <sect2 id="contrib">
    <title>寄贈ソフトウェア</title>

    <para><application>CVS</application> がバージョン 1.11.5 から
      バージョン 1.11.17 に更新されました。</para>

    <para><application>sendmail</application> がバージョン
      8.12.11 からバージョン 8.13.1 に更新されました。</para>

    <para><application>GNU patch</application> のソースファイルが
      <filename>src/contrib/patch</filename> から削除されました。
      &os; は 7 年近く、<filename>src/gnu/usr.bin/patch</filename>
      に置かれた &man.patch.1; のソースを利用しています。</para>

    <para>タイムゾーンデータベースが
      <application>tzdata2004e</application> リリースから
      <application>tzdata2004g</application> リリースに更新されました。</para>
  </sect2>

  <sect2 id="releng">
    <title>リリースエンジニアリングと統合</title>

    <para><application>GNOME</application> のサポートリリースバージョンが、
      2.6 から 2.8.2 に更新されました。
      各コンポーネントの変更一覧は
      <ulink url="http://mail.gnome.org/archives/gnome-announce-list/2004-December/msg00026.html">
	http://mail.gnome.org/archives/gnome-announce-list/2004-December/msg00026.html</ulink>
      にあります。</para>

    <para><application>KDE</application> のサポートリリースバージョンが
      3.2.2 から 3.3.2 に更新されました。</para>

    <para>Linux バイナリ互換機能用のサポートユーザランドパッケージが
      (Red Hat Linux 7.1 ベースの)
      <filename role="package">linux_base</filename> から
      (Red Hat Linux 8.0 ベースの)
      <filename role="package">linux_base-8</filename>
      に更新されました。</para>

    <para><application>X Window System</application>
      のサポートリリースバージョンが、
      <application>XFree86</application> 4.4.0 に更新されました。
      また、Xorg X11R6.8.1 も FreeBSD Ports Collection
      (<filename role="package">x11/xorg</filename>)
      に収録されています。</para>

    <para><filename>make.conf</filename> の
      <varname>NOSECURE</varname> 変数は、
      正常に機能せず保守されていないため、削除されました。
      <varname>NOSECURE</varname> を利用していた場合は、
      代わりに <varname>NOCRYPT</varname> を利用してください。</para>
  </sect2>
</sect1>

<sect1 id="upgrade">
  <title>以前の &os; リリース版からのアップグレード</title>

  <para>以前の &os; リリース版からのアップグレードをおこなうには、
    主に次の 3 つの方法があります。</para>

  <itemizedlist>
    <listitem>
      <para>&man.sysinstall.8; のバイナリアップグレード機能を使う方法。
        おそらくこの方法が最も時間のかからない方法なのですが、
        これは &os; のインストール時に
        特別なコンパイルオプションを指定していないことを前提としています。</para>
    </listitem>

    <listitem>
      <para>&os; を完全に再インストールする方法。
        技術的にはアップグレード手段の一つとは言えませんし、
        <filename>/etc</filename>
        の内容を手動で退避・復元したりする必要があるなど、
        大抵の場合はバイナリアップグレード機能を使うより手間がかかります。
        しかし、ディスクのパーティション分割を変更したい (とか、
        変更しなければならない) 場合などには便利な方法でしょう。</para>
    </listitem>

    <listitem>
      <para><filename>/usr/src</filename> のソースコードから構築する方法。
        この手段は非常に柔軟な対応が可能ですが、
        ディスク空間と時間、そして専門的なノウハウを必要とします。
        詳細については
        <ulink url="http://www.FreeBSD.org/doc/en_US.ISO8859-1/books/handbook/">FreeBSD
          ハンドブック</ulink>の
        <ulink url="http://www.FreeBSD.org/doc/en_US.ISO8859-1/books/handbook/makeworld.html"><quote><command>make world</command> を利用する</quote></ulink> という章をご覧ください。
        また、非常に古いバージョンの &os;
        からのアップグレードは問題が発生することが多いため、
        そのような場合にはバイナリアップグレード、
        もしくは完全な再インストールをおこなった方が効果的でしょう。</para>
    </listitem>
  </itemizedlist>

  <para>なるべくアップグレードを始める前に詳細について
    <filename>INSTALL.TXT</filename> をご覧ください。
    ソースからアップグレードする場合は
    <filename>/usr/src/UPDATING</filename> にも目を通す必要があります。</para>

  <para>最後になりますが、&os; の -STABLE もしくは -CURRENT
    ブランチを追いかけるために用意された手段の一つをとりたいと考えているなら、
    <ulink url="http://www.FreeBSD.org/doc/en_US.ISO8859-1/books/handbook/">FreeBSD
      ハンドブック</ulink>の
    <ulink url="http://www.FreeBSD.org/doc/en_US.ISO8859-1/books/handbook/current-stable.html"><quote>-CURRENT
        vs. -STABLE</quote></ulink> の節をご覧になるようお願いします。</para>

  <important>
    <para>もちろん言うまでもないことですが、
      &os; のアップグレードは、データと設定ファイルを
      <emphasis>すべて</emphasis> バックアップした後におこなうべきです。</para>
  </important>
</sect1>
